# 実装計画

- [ ] 1. OAuth2認証マネージャーの実装
  - OAuth2認証フローを処理するクラスを作成
  - トークンの取得、保存、読み込み、更新の機能を実装
  - _要件: 1.1, 1.2, 1.3, 3.1, 3.2, 3.5_

- [ ] 2. コマンドラインインターフェースの拡張
  - [ ] 2.1 コマンドライン引数のパース機能を実装
    - `setup`サブコマンドのサポート
    - クライアントID、クライアントシークレット、トークンパスのオプション追加
    - _要件: 1.1, 1.2, 3.3_
  
  - [ ] 2.2 環境変数からの設定読み込み機能を実装
    - 環境変数からOAuth2設定を読み込む機能
    - 設定の検証と優先順位の処理
    - _要件: 1.1, 2.3_

- [ ] 3. OAuth2認証フローの実装
  - [ ] 3.1 認証URLの生成と表示
    - ユーザーがブラウザでアクセスするための認証URLを生成
    - コンソールに認証URLを表示
    - _要件: 1.2_
  
  - [ ] 3.2 認証コールバックの処理
    - ローカルサーバーを起動してコールバックを受け取る
    - 認証コードからトークンを取得
    - _要件: 1.2, 1.3_

- [ ] 4. トークン管理機能の実装
  - [ ] 4.1 トークンの保存機能
    - 取得したトークンを指定されたパスに保存
    - ファイルのパーミッション設定
    - _要件: 1.3, 3.1, 3.5_
  
  - [ ] 4.2 トークンの読み込みと更新機能
    - 保存されたトークンの読み込み
    - トークンの有効期限チェックと更新
    - _要件: 1.4, 3.2_

- [ ] 5. SearchConsoleServiceクラスの更新
  - [ ] 5.1 OAuth2認証をサポートするコンストラクタの追加
    - OAuth2クライアントを使用するコンストラクタの実装
    - _要件: 1.4, 2.3_
  
  - [ ] 5.2 サービスアカウント認証の廃止警告の実装
    - サービスアカウント認証使用時の警告メッセージ
    - OAuth2認証への移行を促すメッセージ
    - _要件: 2.2_

- [ ] 6. メインアプリケーションの更新
  - [ ] 6.1 起動フローの更新
    - コマンドラインオプションに基づく処理分岐
    - 適切な認証方法の選択
    - _要件: 1.1, 1.2, 1.4, 2.3_
  
  - [ ] 6.2 エラー処理の実装
    - 設定エラーの処理
    - 認証エラーの処理
    - ファイルエラーの処理
    - _要件: 1.5, 2.4, 3.4_

- [ ] 7. ヘルプとドキュメントの更新
  - [ ] 7.1 コマンドラインヘルプの実装
    - 利用可能なコマンドとオプションの説明
    - 使用例の提供
    - _要件: 4.1_
  
  - [ ] 7.2 READMEの更新
    - OAuth2認証の設定手順
    - 使用方法の説明
    - トラブルシューティング情報
    - _要件: 4.4_

- [ ] 8. テストの実装
  - [ ] 8.1 ユニットテストの作成
    - OAuth2マネージャーのテスト
    - コマンドライン引数のパースと検証のテスト
    - _要件: 1.1, 1.3, 1.4, 1.5_
  
  - [ ] 8.2 統合テストの作成
    - トークンの保存と読み込みのテスト
    - エラー処理のテスト
    - _要件: 1.3, 1.4, 1.5, 3.1, 3.2, 3.4_